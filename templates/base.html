<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Al Qeyam Helpdesk - Ticket Management System">
    <meta name="theme-color" content="#2c5f5f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Helpdesk">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#2c5f5f">
    <meta name="msapplication-config" content="/static/browserconfig.xml">
    <title>{% block title %}Al Qeyam Helpdesk{% endblock %}</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192x192.png') }}">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --teal-dark: #2c5f5f;
            --teal-medium: #4a9b9b;
            --teal-light: #6bc4c4;
            --teal-lighter: #8dd8d8;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #e9ecef;
            --gray-dark: #6c757d;
            --shadow-light: rgba(44, 95, 95, 0.1);
            --shadow-medium: rgba(44, 95, 95, 0.2);
            --shadow-dark: rgba(44, 95, 95, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        /* Global Styles */
        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 50%, var(--teal-light) 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            overflow-x: hidden;
        }

        /* Static Background - No animations for better performance */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(107, 196, 196, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(74, 155, 155, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(44, 95, 95, 0.2) 0%, transparent 50%);
            z-index: -1;
        }

        /* Remove floating shapes for better performance */

        /* Glassmorphism Navbar - Fixed */
        .navbar {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            z-index: 1030;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
        }
        
        /* Main content padding for fixed navbar */
        .main-content {
            padding-top: 120px; /* Padding for fixed navbar */
            min-height: calc(100vh - 120px);
        }
        
        /* Breadcrumb container - Completely Hidden */
        .breadcrumb-container,
        .breadcrumb,
        nav[aria-label="breadcrumb"],
        ol.breadcrumb,
        ul.breadcrumb,
        .breadcrumb-item,
        .breadcrumb-icon,
        [class*="breadcrumb"],
        nav[aria-label*="breadcrumb"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            max-height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -9999px !important;
            width: 0 !important;
        }
        
        /* Ensure content doesn't overlap with fixed header */
        .main-content {
            position: relative;
            z-index: 1;
        }
        
        /* Additional spacing for better layout */
        .main-content .row:first-child {
            margin-top: 0;
        }
        
        .main-content .card:first-child {
            margin-top: 0;
        }


        .navbar-brand {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--white) !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .navbar-brand:hover {
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .nav-link {
            color: var(--white) !important;
            font-weight: 500;
            border-radius: 8px;
            margin: 0 2px;
            padding: 0.5rem 1rem !important;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: var(--glass-shadow);
            z-index: 1050;
        }

        .dropdown-item {
            color: var(--teal-dark);
            border-radius: 8px;
            margin: 2px;
        }

        .dropdown-item:hover {
            background: var(--teal-light);
            color: var(--white);
        }

        .navbar-nav .dropdown {
            z-index: 1050;
        }

        /* Glassmorphism Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.4);
        }

        .card-header {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            color: var(--white);
            border-bottom: 1px solid var(--glass-border);
            font-weight: 600;
        }

        /* Modal layering above glass components */
        .modal {
            z-index: 2100;
        }

        .modal-backdrop.show {
            z-index: 2090;
            background-color: rgba(12, 23, 23, 0.65);
        }

        /* Glassmorphism Buttons */
        .btn {
            border-radius: 12px;
            font-weight: 600;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray-dark) 0%, #495057 100%);
            color: var(--white);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: var(--white);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: var(--white);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: var(--white);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%);
            color: var(--white);
        }

        /* Glassmorphism Forms */
        .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--teal-medium);
            box-shadow: 0 0 0 0.2rem rgba(74, 155, 155, 0.25);
        }

        .form-select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        /* Glassmorphism Tables */
        .table {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--glass-shadow);
        }

        .table thead th {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            color: var(--white);
            border: none;
            font-weight: 600;
        }

        .table tbody tr:hover {
            background: rgba(107, 196, 196, 0.1);
        }

        /* Action Buttons - Always Visible */
        .table .btn-group {
            opacity: 1 !important;
            visibility: visible !important;
            display: flex !important;
        }

        .table .btn-group .btn {
            opacity: 1 !important;
            visibility: visible !important;
            display: flex !important;
            width: 40px !important;
            height: 32px !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 0 !important;
            margin: 0 1.5px !important;
        }

        .table tbody tr .btn-group {
            opacity: 1 !important;
            visibility: visible !important;
        }

        .table tbody tr:hover .btn-group {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Override any potential conflicting CSS */
        .table td .btn-group,
        .table td .btn-group *,
        .table td .btn,
        .table td form {
            opacity: 1 !important;
            visibility: visible !important;
            display: inline-block !important;
        }

        .table td .btn-group {
            display: flex !important;
            gap: 3px !important;
            align-items: center !important;
        }

        .table td .btn-group .btn {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        /* Glassmorphism Alerts */
        .alert {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: var(--glass-shadow);
        }

        .alert-success {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.9) 0%, rgba(32, 201, 151, 0.9) 100%);
            color: var(--white);
        }

        .alert-danger {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.9) 0%, rgba(232, 62, 140, 0.9) 100%);
            color: var(--white);
        }

        .alert-warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.9) 0%, rgba(253, 126, 20, 0.9) 100%);
            color: var(--white);
        }

        .alert-info {
            background: linear-gradient(135deg, rgba(74, 155, 155, 0.9) 0%, rgba(107, 196, 196, 0.9) 100%);
            color: var(--white);
        }

        /* Glassmorphism Breadcrumbs - HIDDEN */
        .breadcrumb,
        nav[aria-label="breadcrumb"],
        ol.breadcrumb {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
        }
        
        /* Original breadcrumb styles - commented out since hidden */
        /*
        .breadcrumb {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1rem 1.5rem;
            box-shadow: var(--glass-shadow);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1020;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .breadcrumb-item:not(:last-child)::after {
            content: '>';
            color: var(--gray-medium);
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .breadcrumb-item a {
            color: var(--teal-medium);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.8rem;
            border-radius: 12px;
            font-weight: 500;
        }

        .breadcrumb-item a:hover {
            color: var(--teal-dark);
            background: rgba(107, 196, 196, 0.1);
        }

        .breadcrumb-item.active {
            color: var(--teal-dark);
            font-weight: 600;
        }

        .breadcrumb-item.active a {
            color: var(--teal-dark);
            background: rgba(44, 95, 95, 0.1);
            padding: 0.5rem 0.8rem;
            border-radius: 12px;
        }

        .breadcrumb-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 0.8rem;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        .breadcrumb-item.active .breadcrumb-icon {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%);
        }
        */

        /* Glassmorphism Badges */
        .badge {
            border-radius: 8px;
            font-weight: 600;
            padding: 0.5rem 0.8rem;
        }


        .bg-primary {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%) !important;
        }

        .bg-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
        }

        .bg-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%) !important;
        }

        .bg-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%) !important;
        }

        .bg-info {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%) !important;
        }

        /* Glassmorphism Modals */
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            color: var(--white);
            border-bottom: 1px solid var(--glass-border);
        }

        /* Glassmorphism Pagination */
        .pagination .page-link {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--glass-border);
            color: var(--teal-dark);
        }

        .pagination .page-link:hover {
            background: var(--teal-light);
            color: var(--white);
        }

        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
            border-color: var(--teal-medium);
        }

        /* Glassmorphism Progress Bars */
        .progress {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%);
            border-radius: 12px;
        }

        /* Glassmorphism Tooltips */
        .tooltip .tooltip-inner {
            background: rgba(44, 95, 95, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 8px;
        }

        /* Glassmorphism Popovers */
        .popover {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: var(--glass-shadow);
        }

        /* Enhanced Mobile Responsive Design */
        @media (max-width: 576px) {
            .navbar {
                padding: 0.5rem 0;
            }
            
            .navbar-brand {
                font-size: 1rem;
            }
            
            .nav-link {
                font-size: 0.85rem;
                padding: 0.4rem 0.6rem !important;
            }
            
            /* Adjust padding for fixed navbar on mobile */
            main.container {
                padding-top: 70px !important;
            }
            
            .container[style*="padding-top"] {
                padding-top: 70px !important;
            }
            
            .card {
                margin-bottom: 1rem;
                border-radius: 12px;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .btn {
                font-size: 0.85rem;
                padding: 0.5rem 0.75rem;
                white-space: nowrap;
            }
            
            .btn-group {
                flex-wrap: wrap;
            }
            
            .btn-group .btn {
                flex: 1 1 auto;
                min-width: 0;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .table th,
            .table td {
                padding: 0.5rem 0.25rem;
            }
            
            .container {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .dropdown-menu {
                font-size: 0.9rem;
                max-width: 90vw;
            }
            
            h1, h2, h3, h4, h5, h6 {
                font-size: 1.25rem;
            }
            
            .breadcrumb {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            .modal-dialog {
                margin: 0.5rem;
            }
            
            .form-control, .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 0.5rem 0;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            /* Adjust padding for fixed navbar on tablet */
            .main-content {
                padding-top: 110px !important;
            }
            
            .breadcrumb-container,
            .breadcrumb,
            nav[aria-label="breadcrumb"] {
                display: none !important;
                visibility: hidden !important;
                height: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            body:has(.breadcrumb) .main-content {
                padding-top: 0.75rem !important;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .btn {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
            
            .table-responsive {
                font-size: 0.9rem;
            }
            
            .col-md-6, .col-md-4, .col-md-3 {
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 992px) {
            .navbar-nav {
                margin-top: 0.5rem;
            }
            
            .dropdown-menu {
                position: static !important;
                float: none;
                width: 100%;
                margin-top: 0.5rem;
            }
        }
        
        /* Touch-friendly targets */
        @media (hover: none) and (pointer: coarse) {
            .btn, .nav-link, .dropdown-item {
                min-height: 44px;
                display: flex;
                align-items: center;
            }
            
            .form-control, .form-select {
                min-height: 44px;
            }
        }
        
        /* PWA Install Prompt */
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--glass-shadow);
            z-index: 1040;
            max-width: 90%;
            display: none;
        }
        
        .pwa-install-prompt.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        /* Safe area for notched devices */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
            
            .navbar {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
            }
        }

        /* Performance optimized - animations removed */

        /* Interactive Hover Effects - simplified */
        .interactive {
            cursor: pointer;
        }

        .interactive:hover {
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        /* Loading States - simplified */
        .loading {
            position: relative;
            overflow: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--teal-medium) 0%, var(--teal-light) 100%);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal-medium) 100%);
        }

        /* Main Container */
        main.container {
            position: relative;
            z-index: 1;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        /* Status and Priority Colors */
        .priority-high {
            border-left: 4px solid #dc3545;
        }
        .priority-medium {
            border-left: 4px solid #ffc107;
        }
        .priority-low {
            border-left: 4px solid #28a745;
        }
        .priority-critical {
            border-left: 4px solid #6f42c1;
        }
        .status-open {
            background-color: rgba(227, 242, 253, 0.8);
        }
        .status-assigned {
            background-color: rgba(255, 243, 224, 0.8);
        }
        .status-in-progress {
            background-color: rgba(232, 245, 232, 0.8);
        }
        .status-resolved {
            background-color: rgba(243, 229, 245, 0.8);
        }
        .status-closed {
            background-color: rgba(245, 245, 245, 0.8);
        }

        /* Status and Category Circles */
        .status-item, .category-item {
            text-align: center;
            padding: 1rem 0;
        }

        .status-circle, .category-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .status-circle:hover, .category-circle:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .status-number, .category-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .status-label, .category-label {
            font-weight: 600;
            color: var(--teal-dark);
            margin: 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Floating Background Shapes - Removed for performance -->

    <!-- Glassmorphism Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                                        <i class="fas fa-headset me-2"></i>Al Qeyam Helpdesk
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('dashboard') }}">
                                <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                            </a>
                        </li>
                        {% if current_user.role in ['admin', 'super_admin'] %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-shield me-1"></i>Admin Tools
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('admin_users') }}">
                                        <i class="fas fa-users me-1"></i>Manage Users
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_tickets') }}">
                                        <i class="fas fa-list me-1"></i>All Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_open_tickets') }}">
                                        <i class="fas fa-door-open me-1"></i>Open Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_pending_tickets') }}">
                                        <i class="fas fa-hourglass-half me-1"></i>Pending Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_closed_tickets') }}">
                                        <i class="fas fa-check-circle me-1"></i>Closed Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_search_tickets') }}">
                                        <i class="fas fa-search me-1"></i>Search Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_summary_reports') }}">
                                        <i class="fas fa-chart-bar me-1"></i>Summary Reports
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('create_ticket') }}">
                                        <i class="fas fa-plus me-1"></i>Create Ticket
                                    </a></li>
                                </ul>
                            </li>
                        {% endif %}
                        {% if current_user.role in ['it_agent', 'fm_agent'] %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="agentDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-tools me-1"></i>Agent Tools
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('admin_tickets') }}">
                                        <i class="fas fa-list me-1"></i>All Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_search_tickets') }}">
                                        <i class="fas fa-search me-1"></i>Search Tickets
                                    </a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_summary_reports') }}">
                                        <i class="fas fa-chart-bar me-1"></i>Summary Reports
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('create_ticket') }}">
                                        <i class="fas fa-plus me-1"></i>Create Ticket
                                    </a></li>
                                </ul>
                            </li>
                        {% else %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('create_ticket') }}">
                                    <i class="fas fa-plus me-1"></i>New Ticket
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('my_ticket_summary') }}">
                                    <i class="fas fa-chart-line me-1"></i>My Summary
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                <ul class="navbar-nav">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i>{{ current_user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><span class="dropdown-item-text text-muted">{{ current_user.role|title }}</span></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i>Login
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>


    <!-- Breadcrumb Section - Completely Removed -->
    {% block breadcrumb %}
    {% endblock %}

    <!-- Main Content - padding adjusted based on breadcrumb presence -->
    <main class="container main-content" style="padding-top: 0.5rem;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' }} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- PWA Install Prompt -->
    <div id="pwaInstallPrompt" class="pwa-install-prompt">
        <div class="d-flex align-items-center justify-content-between">
            <div class="me-3">
                <i class="fas fa-mobile-alt fa-2x text-primary"></i>
            </div>
            <div class="flex-grow-1">
                <h6 class="mb-1">Install Helpdesk App</h6>
                <p class="mb-0 small text-muted">Add to home screen for quick access</p>
            </div>
            <div class="ms-3">
                <button id="pwaInstallBtn" class="btn btn-primary btn-sm">
                    <i class="fas fa-download me-1"></i>Install
                </button>
                <button id="pwaDismissBtn" class="btn btn-link btn-sm text-muted">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Session management to prevent automatic logout
        let sessionCheckInterval;
        
        // Session management removed for better user experience
        
        // Add animation classes to elements
        document.addEventListener('DOMContentLoaded', function() {
            // Session monitoring removed for better user experience
            
            // Performance optimized - animations removed
            
            // Calculate navbar height and adjust main content padding dynamically
            const navbar = document.querySelector('.navbar');
            const mainContent = document.querySelector('.main-content');
            
            if (navbar && mainContent) {
                const navbarHeight = navbar.offsetHeight || 80;
                const requiredPadding = navbarHeight + 40; // Extra 40px for spacing
                mainContent.style.paddingTop = requiredPadding + 'px';
            }
            
            // Hide breadcrumb container
            const breadcrumbContainer = document.querySelector('.breadcrumb-container');
            if (breadcrumbContainer) {
                breadcrumbContainer.style.display = 'none';
            }
            
            // Optimize for high traffic - lazy load images and defer non-critical scripts
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        observer.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
            
            // PWA Service Worker Registration
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/static/service-worker.js')
                        .then((registration) => {
                            console.log('Service Worker registered:', registration.scope);
                            
                            // Check for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // New service worker available
                                        console.log('New service worker available');
                                    }
                                });
                            });
                        })
                        .catch((error) => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            }
            
            // PWA Install Prompt
            let deferredPrompt;
            const installPrompt = document.getElementById('pwaInstallPrompt');
            const installBtn = document.getElementById('pwaInstallBtn');
            const dismissBtn = document.getElementById('pwaDismissBtn');
            
            // Check if already installed
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                // App is already installed
                console.log('PWA already installed');
            } else {
                // Listen for beforeinstallprompt event
                window.addEventListener('beforeinstallprompt', (e) => {
                    // Prevent the mini-infobar from appearing
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    // Show install prompt if not dismissed
                    if (!localStorage.getItem('pwaInstallDismissed')) {
                        setTimeout(() => {
                            installPrompt.classList.add('show');
                        }, 3000); // Show after 3 seconds
                    }
                });
                
                // Install button click
                if (installBtn) {
                    installBtn.addEventListener('click', async () => {
                        if (deferredPrompt) {
                            deferredPrompt.prompt();
                            const { outcome } = await deferredPrompt.userChoice;
                            console.log('User choice:', outcome);
                            deferredPrompt = null;
                            installPrompt.classList.remove('show');
                        }
                    });
                }
                
                // Dismiss button click
                if (dismissBtn) {
                    dismissBtn.addEventListener('click', () => {
                        installPrompt.classList.remove('show');
                        localStorage.setItem('pwaInstallDismissed', 'true');
                    });
                }
            }
            
            // Handle app installed event
            window.addEventListener('appinstalled', () => {
                console.log('PWA installed');
                installPrompt.classList.remove('show');
                deferredPrompt = null;
            });
        });
        
        // Cleanup on page unload - session monitoring removed
    </script>
</body>
</html> 